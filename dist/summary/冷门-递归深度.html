<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>冷门-递归深度 | TS 类型挑战通关手册</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="刷题吧少年">
    
    <link rel="preload" href="/type-challenge/dist/assets/css/0.styles.95e27c78.css" as="style"><link rel="preload" href="/type-challenge/dist/assets/js/app.f1078917.js" as="script"><link rel="preload" href="/type-challenge/dist/assets/js/2.fab40c16.js" as="script"><link rel="preload" href="/type-challenge/dist/assets/js/8.506854ad.js" as="script"><link rel="prefetch" href="/type-challenge/dist/assets/js/10.ad8c07ba.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/100.40aaad2d.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/101.151078b6.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/102.f0844e5a.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/103.42397d93.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/104.258348e6.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/105.00ddd0bc.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/106.bbb0ef5e.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/107.769a042f.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/108.d8dc3770.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/109.2ff3394a.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/11.50c2b0a2.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/110.3379c03e.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/111.a515a09f.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/112.b12e90fc.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/113.bb7eb29c.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/114.b73e31e7.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/115.2d31dffb.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/116.2949b6d6.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/117.9a4b9e8a.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/118.810234f1.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/119.8124fb92.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/12.923cad6f.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/120.4482b6c9.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/121.6de3417b.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/122.801183e4.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/123.8cc25df1.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/124.a7af5286.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/125.6954a03e.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/126.48f0f978.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/127.83ee5ccb.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/128.778889e9.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/129.25c2fdb0.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/13.d6a23e5c.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/130.6a8a48ae.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/131.bf9dab77.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/132.fa274304.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/133.37c4144b.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/134.593ff7d4.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/135.73904375.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/136.0cdbe6e9.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/137.71a6a296.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/138.5235a049.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/139.f27de16b.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/14.6ea226bb.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/140.2d41b3ff.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/141.e70b5ed6.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/142.694909ef.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/143.1b59f65a.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/144.663fc3ee.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/145.2a013fa2.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/146.5b143f47.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/147.4344cf50.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/148.6ee54145.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/149.86d51806.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/15.78c0ee76.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/150.a9824342.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/151.11e2fad4.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/152.c23b1091.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/153.c5568dcd.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/154.82c02612.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/155.c2b99e6c.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/156.45a799d6.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/157.ebe17720.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/158.fba1c7dc.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/159.153b8537.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/16.00aea70d.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/160.fb384749.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/161.0533fcca.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/162.fbe7cf84.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/163.8adce82f.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/164.010c188f.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/165.ddf6a9be.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/166.da90552b.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/167.8cdc6d12.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/17.dc73dafb.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/18.27674601.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/19.7017e29f.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/20.7e23205d.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/21.b4dfdcd5.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/22.dee47290.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/23.5c5e9d38.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/24.12951e1b.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/25.c12ce6d6.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/26.b26092c1.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/27.b4f81d93.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/28.d6b33e43.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/29.b9519e6b.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/3.7de3b660.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/30.ea0af48d.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/31.754cf1bc.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/32.7fae703f.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/33.efe9150a.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/34.106c0997.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/35.1760b001.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/36.ad08c4ca.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/37.bffd65a5.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/38.04742de5.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/39.5fe99766.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/4.6024067a.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/40.e4fd1445.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/41.da67b472.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/42.6f5c5540.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/43.314ee529.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/44.2941e88c.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/45.a612a491.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/46.bc07da3c.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/47.319db286.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/48.7b5031d3.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/49.5bc8bb7e.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/5.985bc7cf.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/50.466b68f0.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/51.3ad5d8e2.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/52.5532fc55.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/53.5698a3a1.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/54.d8c4723b.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/55.bb58a0ee.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/56.9027ed11.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/57.19a0f843.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/58.6e880c0f.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/59.89bb262b.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/6.60eba790.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/60.c1e2993f.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/61.a3919fe4.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/62.2a114b90.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/63.09cd426b.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/64.bc198879.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/65.979b403a.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/66.2134c91c.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/67.36034e96.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/68.dbf5d9bf.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/69.c76b6af3.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/7.a9ae96f2.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/70.d1cf3105.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/71.8329fccb.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/72.26f4bad1.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/73.6030155d.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/74.b2b2eafd.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/75.21e0d5b4.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/76.faa0db12.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/77.5ee3f4d3.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/78.fc66abad.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/79.590a9d30.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/80.5954be50.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/81.729ceba9.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/82.564bca9a.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/83.e16d27bd.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/84.cdada711.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/85.332108b3.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/86.aa12f270.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/87.f26b9699.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/88.e7d9dd3f.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/89.08331af8.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/9.be4c9522.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/90.5818cfee.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/91.ec6b0ae7.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/92.b1f23821.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/93.993024ed.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/94.af3fa85c.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/95.2eebf742.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/96.b779da1b.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/97.87aebd4a.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/98.d6b5e7f3.js"><link rel="prefetch" href="/type-challenge/dist/assets/js/99.48ba026f.js">
    <link rel="stylesheet" href="/type-challenge/dist/assets/css/0.styles.95e27c78.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/type-challenge/dist/" class="home-link router-link-active"><!----> <span class="site-name">TS 类型挑战通关手册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/type-challenge/dist/" class="nav-link">
  关于本文档
</a></div><div class="nav-item"><a href="https://github.com/yuzai/type-challenge" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/type-challenge/dist/" class="nav-link">
  关于本文档
</a></div><div class="nav-item"><a href="https://github.com/yuzai/type-challenge" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/type-challenge/dist/" aria-current="page" class="sidebar-link">关于本文档</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>简单</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中等</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>困难</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>地狱级</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>通用技巧总结</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/type-challenge/dist/summary/基操-判断两个类型相等.html" class="sidebar-link">基操-判断两个类型相等</a></li><li><a href="/type-challenge/dist/summary/冷门-递归深度.html" class="active sidebar-link">冷门-递归深度</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/type-challenge/dist/summary/冷门-递归深度.html#问题复现" class="sidebar-link">问题复现</a></li><li class="sidebar-sub-header"><a href="/type-challenge/dist/summary/冷门-递归深度.html#尾调用、尾递归" class="sidebar-link">尾调用、尾递归</a></li><li class="sidebar-sub-header"><a href="/type-challenge/dist/summary/冷门-递归深度.html#ts-中的尾递归优化" class="sidebar-link">ts 中的尾递归优化</a></li><li class="sidebar-sub-header"><a href="/type-challenge/dist/summary/冷门-递归深度.html#结论" class="sidebar-link">结论</a></li></ul></li><li><a href="/type-challenge/dist/summary/基操-箭头函数重载.html" class="sidebar-link">基操-箭头函数重载</a></li><li><a href="/type-challenge/dist/summary/基操-对象遍历的as和索引访问.html" class="sidebar-link">基操-对象遍历的as和索引访问</a></li><li><a href="/type-challenge/dist/summary/基操-类型推断的边界条件.html" class="sidebar-link">基操-类型推断的边界条件</a></li><li><a href="/type-challenge/dist/summary/基操-类型转换大集合.html" class="sidebar-link">基操-类型转换大集合</a></li><li><a href="/type-challenge/dist/summary/基操-元组遍历的黑科技.html" class="sidebar-link">基操-元组遍历的黑科技</a></li><li><a href="/type-challenge/dist/summary/进阶-计数-加减乘除.html" class="sidebar-link">进阶-计数-加减乘除</a></li><li><a href="/type-challenge/dist/summary/进阶-逆变顺变协变.html" class="sidebar-link">进阶-逆变顺变协变</a></li><li><a href="/type-challenge/dist/summary/冷门-字面量类型和基础类型.html" class="sidebar-link">冷门-字面量类型和基础类型</a></li><li><a href="/type-challenge/dist/summary/算法-排列组合大乱炖.html" class="sidebar-link">算法-排列组合大乱炖</a></li><li><a href="/type-challenge/dist/summary/战斗基-联合类型的分发特性.html" class="sidebar-link">战斗基-联合类型的分发特性</a></li></ul></section></li><li><a href="/type-challenge/dist/Contactme.html" class="sidebar-link">联系我</a></li><li><a href="/type-challenge/dist/Contributors.html" class="sidebar-link">贡献者</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="frontmatter-title"><a href="#frontmatter-title" class="header-anchor">#</a> 冷门-递归深度</h1> <p>相信大家在做 ts 类型体操的过程中，偶尔会碰到 <code>Type instantiation is excessively deep and possibly infinite.ts(2589)</code> 这个告警，往往比较懵逼，而且网上关于这一部分的讨论，其实也不多。</p> <p>绝大部分文章会告诉你，递归深度控制在 50 以内，就不会有这个问题，但是实际情况中，往往有时候我们的递归深度可以超过 50，达到 999，也不会触发这个问题，直到达到 1000。</p> <p>本文便是对这一问题的解惑。</p> <h2 id="问题复现"><a href="#问题复现" class="header-anchor">#</a> 问题复现</h2> <p>我们以计算字符的长度问题为例，复现这种情况。</p> <p>要计算字符长度，我们在 <a href="/medium/298-%E8%AE%A1%E7%AE%97%E5%AD%97%E7%AC%A6%E7%9A%84%E9%95%BF%E5%BA%A6">298-计算字符长度</a> 中讨论过解法，思路有两种：</p> <p>第一种，遍历字符，将字符转换成元组，元组 length 就是要求的长度，代码如下：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">StringToUnion<span class="token operator">&lt;</span><span class="token constant">S</span> <span class="token keyword">extends</span> <span class="token builtin">string</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">S</span> <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token builtin">string</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">infer</span> <span class="token constant">R</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">...</span>StringToUnion<span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>
  <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Case1 = 20</span>
<span class="token keyword">type</span> <span class="token class-name">Case1</span> <span class="token operator">=</span> StringToUnion<span class="token operator">&lt;</span><span class="token string">'12345678901234567890'</span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token string">'length'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>第二种，也是遍历字符，通过增加一个辅助的计数元组，每次遍历一个字符，就往辅助元组里塞一个值，最终，遍历结束，辅助元组的长度就是题解。代码如下：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">LengthOfString<span class="token operator">&lt;</span>
  <span class="token constant">S</span> <span class="token keyword">extends</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  Arr <span class="token keyword">extends</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">S</span> <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token builtin">string</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">infer</span> <span class="token constant">R</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token operator">?</span> LengthOfString<span class="token operator">&lt;</span><span class="token constant">R</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span>Arr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
  <span class="token operator">:</span> Arr<span class="token punctuation">[</span><span class="token string">'length'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Case2 = 20</span>
<span class="token keyword">type</span> <span class="token class-name">Case2</span> <span class="token operator">=</span> LengthOfString<span class="token operator">&lt;</span><span class="token string">'12345678901234567890'</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><p>这两种解法看着没什么区别，但是当字符长度达到 <strong>49</strong> 时，解法一，就会出现 <code>Type instantiation is excessively deep and possibly infinite.ts(2589)</code> 这个问题，而解法二，会在字符长度达到 <strong>1000</strong> 时，才会出现这个问题。</p> <p>此时，我不知道读者第一次看到这两种解法对不同长度字符的处理有区别时，是什么感受，我内心的感受可以用这个表情包感受下：</p> <p><img src="data:image/jpeg;base64,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" alt="img">。</p> <p>黑人问号脸.jpg</p> <p>同样是递归，这有啥区别？为什么第一种解法只能递归 50 次，而解法二，能够到 1000 呢？</p> <h2 id="尾调用、尾递归"><a href="#尾调用、尾递归" class="header-anchor">#</a> 尾调用、尾递归</h2> <p>以下来自 <a href="https://zh.wikipedia.org/wiki/%E5%B0%BE%E8%B0%83%E7%94%A8" target="_blank" rel="noopener noreferrer">维基百科<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：</p> <p>在计算机学里，<strong>尾调用</strong>是指一个函数里的最后一个动作是返回一个函数的调用结果的情形，即最后一步新调用的返回值直接被当前函数的返回结果。此时，该尾部调用位置被称为<strong>尾位置</strong>。尾调用中有一种重要而特殊的情形叫做<strong>尾递归</strong>。经过适当处理，尾递归形式的函数的运行效率可以被极大地优化。尾调用原则上都可以通过简化函数调用栈的结构而获得性能优化（称为“尾调用消除”），但是优化尾调用是否方便可行取决于运行环境对此类优化的支持程度如何。</p> <p>关于 js 中的尾调用优化，可以参考 <a href="https://www.ruanyifeng.com/blog/2015/04/tail-call.html" target="_blank" rel="noopener noreferrer">阮老师的文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。文章写的简单通透，我就不在这里做重复工作了。</p> <h2 id="ts-中的尾递归优化"><a href="#ts-中的尾递归优化" class="header-anchor">#</a> ts 中的尾递归优化</h2> <p>通过搜索 ts 的 checker.ts 代码，具体可以查看 <a href="https://raw.githubusercontent.com/microsoft/TypeScript/v5.0.4/src/compiler/checker.ts" target="_blank" rel="noopener noreferrer">源码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中搜索: <code>Type_instantiation_is_excessively_deep_and_possibly_infinite</code>。</p> <p>可以浅显的看到：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>tailCount <span class="token operator">===</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">error</span><span class="token punctuation">(</span>
    currentNode<span class="token punctuation">,</span>
    Diagnostics<span class="token punctuation">.</span>Type_instantiation_is_excessively_deep_and_possibly_infinite<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  result <span class="token operator">=</span> errorType<span class="token punctuation">;</span>
  <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果尾递归超过了 1000，会报这个错误。</p> <p>而单纯的递归：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">instantiateTypeWithAlias</span><span class="token punctuation">(</span>
  type<span class="token operator">:</span> Type<span class="token punctuation">,</span>
  mapper<span class="token operator">:</span> TypeMapper<span class="token punctuation">,</span>
  aliasSymbol<span class="token operator">:</span> Symbol <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  aliasTypeArguments<span class="token operator">:</span> <span class="token keyword">readonly</span> Type<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Type <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">couldContainTypeVariables</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> type<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>instantiationDepth <span class="token operator">===</span> <span class="token number">100</span> <span class="token operator">||</span> instantiationCount <span class="token operator">&gt;=</span> <span class="token number">5000000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// We have reached 100 recursive type instantiations, or 5M type instantiations caused by the same statement</span>
    <span class="token comment">// or expression. There is a very high likelyhood we're dealing with a combination of infinite generic types</span>
    <span class="token comment">// that perpetually generate new type identities, so we stop the recursion here by yielding the error type.</span>
    tracing<span class="token operator">?.</span><span class="token function">instant</span><span class="token punctuation">(</span>tracing<span class="token punctuation">.</span>Phase<span class="token punctuation">.</span>CheckTypes<span class="token punctuation">,</span> <span class="token string">'instantiateType_DepthLimit'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      typeId<span class="token operator">:</span> type<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
      instantiationDepth<span class="token punctuation">,</span>
      instantiationCount<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">error</span><span class="token punctuation">(</span>
      currentNode<span class="token punctuation">,</span>
      Diagnostics<span class="token punctuation">.</span>Type_instantiation_is_excessively_deep_and_possibly_infinite<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> errorType<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  totalInstantiationCount<span class="token operator">++</span><span class="token punctuation">;</span>
  instantiationCount<span class="token operator">++</span><span class="token punctuation">;</span>
  instantiationDepth<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">instantiateTypeWorker</span><span class="token punctuation">(</span>
    type<span class="token punctuation">,</span>
    mapper<span class="token punctuation">,</span>
    aliasSymbol<span class="token punctuation">,</span>
    aliasTypeArguments<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  instantiationDepth<span class="token operator">--</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在深度超过了 100 或者内存占用超过了 5M，也会报这个错误。</p> <p>但是实际用下来，应该是超过 50 就会报错，这块的逻辑有懂的可以 <a href="/type-challenge/dist/Contactme.html">联系我</a> (也可拉你进群一起提讨论 提 PR)，非常乐意讨论交流。</p> <h2 id="结论"><a href="#结论" class="header-anchor">#</a> 结论</h2> <p>对于 上述计算字符长度的解法一：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">StringToUnion<span class="token operator">&lt;</span><span class="token constant">S</span> <span class="token keyword">extends</span> <span class="token builtin">string</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">S</span> <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token builtin">string</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">infer</span> <span class="token constant">R</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">...</span>StringToUnion<span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>
  <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Case1 = 20</span>
<span class="token keyword">type</span> <span class="token class-name">Case1</span> <span class="token operator">=</span> StringToUnion<span class="token operator">&lt;</span><span class="token string">'12345678901234567890'</span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token string">'length'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>它的返回值并不是一个函数执行的返回值，所以并没有触发尾调用，此时深度只能达到 50 (但是看代码是 100，这块我也不清楚了)</p> <p>对于解法二：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">LengthOfString<span class="token operator">&lt;</span>
  <span class="token constant">S</span> <span class="token keyword">extends</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  Arr <span class="token keyword">extends</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">S</span> <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token builtin">string</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">infer</span> <span class="token constant">R</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token operator">?</span> LengthOfString<span class="token operator">&lt;</span><span class="token constant">R</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span>Arr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
  <span class="token operator">:</span> Arr<span class="token punctuation">[</span><span class="token string">'length'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Case2 = 20</span>
<span class="token keyword">type</span> <span class="token class-name">Case2</span> <span class="token operator">=</span> LengthOfString<span class="token operator">&lt;</span><span class="token string">'12345678901234567890'</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><p>返回值，就是自身，触发了尾递归，此时深度可以达到 1000。</p> <p>好了，这就是关于 ts 中递归深度的讨论，</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2023/5/16 14:00:28</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/type-challenge/dist/summary/基操-判断两个类型相等.html" class="prev">
        基操-判断两个类型相等
      </a></span> <span class="next"><a href="/type-challenge/dist/summary/基操-箭头函数重载.html">
        基操-箭头函数重载
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/type-challenge/dist/assets/js/app.f1078917.js" defer></script><script src="/type-challenge/dist/assets/js/2.fab40c16.js" defer></script><script src="/type-challenge/dist/assets/js/8.506854ad.js" defer></script>
  </body>
</html>
